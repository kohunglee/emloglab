"use strict";function SymbolDef(e,n,a,t){this._bits=0,this.defun=void 0,this.eliminated=0,this.id=e,this.init=t,this.mangled_name=null,this.name=a.name,this.orig=[a],this.references=[],this.replaced=0,this.safe_ids=void 0,this.scope=n}function is_funarg(e){return e.orig[0]instanceof AST_SymbolFunarg||e.orig[1]instanceof AST_SymbolFunarg}SymbolDef.prototype={forEach:function(e){this.orig.forEach(e),this.references.forEach(e)},mangle:function(e){var n,a;this.mangled_name||((n=this.global&&e.cache&&e.cache.props)&&n.has(this.name)?this.mangled_name=n.get(this.name):this.unmangleable(e)||(a=this.redefined(),this.mangled_name=a?a.mangled_name||a.name:next_mangled_name(this,e),n&&n.set(this.name,this.mangled_name)))},redefined:function(){var n,e=this,a=e.defun;return(a=a&&(a.variables.get(n=e.name)||a instanceof AST_Toplevel&&a.globals.get(n)||e.orig[0]instanceof AST_SymbolConst&&find_if(function(e){return e.name==n},a.enclosed)))&&a!==e?a.redefined()||a:void 0},unmangleable:function(e){if(this.exported)return!0;if(this.undeclared)return!0;if(!e.eval&&this.scope.pinned())return!0;if(e.keep_fargs&&is_funarg(this))return!0;if(e.keep_fnames){var n=this.orig[0];if(n instanceof AST_SymbolClass)return!0;if(n instanceof AST_SymbolDefClass)return!0;if(n instanceof AST_SymbolDefun)return!0;if(n instanceof AST_SymbolLambda)return!0}return!(e.toplevel||!this.global)}},DEF_BITPROPS(SymbolDef,["const_redefs","cross_loop","direct_access","exported","global","undeclared"]);var unary_side_effects=makePredicate("delete ++ --");function is_lhs(e,n){return n instanceof AST_Assign?n.left===e&&e:n instanceof AST_DefaultValue?n.name===e&&e:n instanceof AST_Destructured||n instanceof AST_DestructuredKeyVal?e:n instanceof AST_ForEnumeration?n.init===e&&e:n instanceof AST_Unary?unary_side_effects[n.operator]&&n.expression:void 0}function init_block_vars(e,n,a){e.enclosed=a?a.enclosed.slice():[],e.functions=a?a.functions.clone():new Dictionary,e.variables=a?a.variables.clone():new Dictionary,n&&(e.make_def=n.make_def,e.parent_scope=n)}function init_scope_vars(e,n,a){init_block_vars(e,n,a),e.uses_eval=!1,e.uses_with=!1}function names_in_use(e,n){var a,t=e.names_in_use;return t||(e.cname=-1,e.cname_holes=[],e.names_in_use=t=new Dictionary,a=n.cache&&n.cache.props,e.enclosed.forEach(function(e){e.unmangleable(n)&&t.set(e.name,!0),e.global&&a&&a.has(e.name)&&t.set(a.get(e.name),!0)})),t}function next_mangled_name(e,a){var n,t=e.scope,i=names_in_use(t,a),o=t.cname_holes,r=new Dictionary,s=[t];e.forEach(function(e){var n=e.scope;do{if(member(n,s))break;names_in_use(n,a).each(function(e,n){r.set(n,e)}),s.push(n)}while(n=n.parent_scope)});for(var c=0;c<o.length;c++)if(n=base54(o[c]),!r.has(n))return o.splice(c,1),i.set(n,!0),n;for(;;)if(n=base54(++t.cname),!(i.has(n)||RESERVED_WORDS[n]||a.reserved.has[n])){if(!r.has(n))break;o.push(t.cname)}return i.set(n,!0),n}function _default_mangler_options(e){return e=defaults(e,{eval:!1,ie:!1,keep_fargs:!1,keep_fnames:!1,reserved:[],toplevel:!1,v8:!1,webkit:!1}),Array.isArray(e.reserved)||(e.reserved=[]),push_uniq(e.reserved,"arguments"),e.reserved.has=makePredicate(e.reserved),e}AST_Toplevel.DEFMETHOD("figure_out_scope",function(l){l=defaults(l,{cache:null,ie:!1});var _=this,r=null,s=!1,a=0,c=_.parent_scope=null,u=new TreeWalker(function(t,e){var n,a;if(t instanceof AST_DefClass)return n=s,s=u.parent()instanceof AST_ExportDeclaration,t.name.walk(u),s=n,o(function(){t.extends&&t.extends.walk(u),t.properties.forEach(function(e){e.walk(u)})}),!0;if(t instanceof AST_Definitions)return n=s,s=u.parent()instanceof AST_ExportDeclaration,e(),s=n,!0;if(t instanceof AST_LambdaDefinition)return n=s,s=u.parent()instanceof AST_ExportDeclaration,t.name.walk(u),s=n,o(function(){t.argnames.forEach(function(e){e.walk(u)}),t.rest&&t.rest.walk(u),walk_body(t,u)}),!0;if(t instanceof AST_Switch)return t.expression.walk(u),o(function(){walk_body(t,u)}),!0;if(t instanceof AST_SwitchBranch)return t.init_vars(c),e(),!0;if(t instanceof AST_Try)return o(function(){walk_body(t,u)}),t.bcatch&&t.bcatch.walk(u),t.bfinally&&t.bfinally.walk(u),!0;if(t instanceof AST_With){for(var i=c;!(i=i.resolve()).uses_with&&(i.uses_with=!0,i=i.parent_scope););return o(e),!0}if(t instanceof AST_BlockScope)return o(e),!0;function o(e){t.init_vars(c);var n=r,a=c;t instanceof AST_Scope&&(r=t),c=t,e(),c=a,r=n}t instanceof AST_Symbol&&(t.scope=c),t instanceof AST_Label&&((t.thedef=t).references=[]),t instanceof AST_SymbolCatch?c.def_variable(t).defun=r:t instanceof AST_SymbolConst?((a=c.def_variable(t)).defun=r,s&&(a.exported=!0)):t instanceof AST_SymbolDefun?(a=r.def_function(t,u.parent()),s&&(a.exported=!0)):t instanceof AST_SymbolFunarg?r.def_variable(t):t instanceof AST_SymbolLambda?(a=r.def_function(t,"arguments"==t.name?void 0:r),l.ie&&"arguments"!=t.name&&(a.defun=r.parent_scope.resolve())):t instanceof AST_SymbolLet?(a=c.def_variable(t),s&&(a.exported=!0)):t instanceof AST_SymbolVar&&(a=r.def_variable(t,t instanceof AST_SymbolImport?void 0:null),s)&&(a.exported=!0)}),d=(_.make_def=function(e,n){return new SymbolDef(++a,this,e,n)},_.walk(u),_.globals=new Dictionary,[]),u=new TreeWalker(function(e){if(e instanceof AST_Catch)return e.argname instanceof AST_Destructured?(d.push(e),e.argname.walk(u),d.pop(),walk_body(e,u),!0):void 0;if(e instanceof AST_Lambda)return d.push(e),e.name&&e.name.walk(u),e.argnames.forEach(function(e){e.walk(u)}),e.rest&&e.rest.walk(u),d.pop(),walk_lambda(e,u),!0;if(e instanceof AST_LoopControl)return e.label&&e.label.thedef.references.push(e),!0;if(e instanceof AST_SymbolDeclaration){var n,a=e.definition();if(a.preinit=a.references.length,e instanceof AST_SymbolCatch){if(n=a.redefined())for(var t=e.scope;t&&push_uniq(t.enclosed,n)&&t!==n.scope;t=t.parent_scope);}else e instanceof AST_SymbolConst?(n=a.redefined())&&(n.const_redefs=!0):a.scope!==e.scope&&(e instanceof AST_SymbolDefun||e instanceof AST_SymbolFunarg||e instanceof AST_SymbolVar)&&(e.mark_enclosed(l),n=e.scope.find_variable(e.name),e.thedef!==n)&&((e.thedef=n).orig.push(e),e.mark_enclosed(l));return"arguments"!=e.name||(i=e instanceof AST_SymbolVar&&u.parent())instanceof AST_VarDef&&!i.value||(r=e.scope.resolve().find_variable("arguments"))&&m(r)&&(r.scope.uses_arguments=3),!0}if(e instanceof AST_SymbolRef){for(var i,o=e.name,r=e.scope.find_variable(o),s=d.length;0<s&&r&&!((s=d.lastIndexOf(r.scope,s-1))<0);){var c=r.orig[0];if(c instanceof AST_SymbolCatch||c instanceof AST_SymbolFunarg||c instanceof AST_SymbolLambda){e.in_arg=!0;break}r=r.scope.parent_scope.find_variable(o)}if(r?"arguments"==o&&m(r)&&(is_lhs(e,i=u.parent())?r.scope.uses_arguments=3:r.scope.uses_arguments<2&&!(i instanceof AST_PropAccess&&i.expression===e)?r.scope.uses_arguments=2:r.scope.uses_arguments||(r.scope.uses_arguments=!0)):r=_.def_global(e),"eval"==o)if("Call"==(i=u.parent()).TYPE&&i.expression===e)for(t=e.scope;!(t=t.resolve()).uses_eval&&(t.uses_eval=!0,t=t.parent_scope););else r.undeclared&&(_.uses_eval=!0);if(r.init instanceof AST_LambdaDefinition&&r.scope!==r.init.name.scope){var f=e.scope;do{if(f===r.init.name.scope)break}while(f=f.parent_scope);f||(r.init=void 0)}return e.thedef=r,e.reference(l),!0}});function m(e){return e.orig[0]instanceof AST_SymbolFunarg&&!(e.orig[1]instanceof AST_SymbolFunarg||e.orig[2]instanceof AST_SymbolFunarg)&&!is_arrow(e.scope)}function t(e,n){var a,t,i=e.name,o=e.thedef;if(all(o.orig,function(e){return!(e instanceof AST_SymbolConst||e instanceof AST_SymbolLet)}))return(a=n.find_variable(i))?(t=a.redefined())&&(a=t):a=_.globals.get(i),a?a.orig.push(e):a=n.def_variable(e),a.undeclared&&_.variables.set(i,a),"arguments"==i&&m(o)&&e instanceof AST_SymbolLambda||(o.defun=a.scope,o.forEach(function(e){e.redef=o,e.thedef=a,e.reference(l)})),1}_.walk(u),l.ie&&_.walk(new TreeWalker(function(e){var n,a;return e instanceof AST_SymbolCatch?(n=(a=e.thedef).defun,t(e,n="arguments"!=a.name&&n.name instanceof AST_SymbolLambda&&n.name.name==a.name?n.parent_scope.resolve():n),!0):e instanceof AST_SymbolLambda?(a=e.thedef,t(e,e.scope.parent_scope.resolve())?void 0!==e.thedef.init?e.thedef.init=!1:a.init&&(e.thedef.init=a.init):a.defun=void 0,!0):void 0}))}),AST_Toplevel.DEFMETHOD("def_global",function(e){var n=this.globals,a=e.name;return n.has(a)?n.get(a):((e=this.make_def(e)).undeclared=!0,e.global=!0,n.set(a,e),e)}),AST_BlockScope.DEFMETHOD("init_vars",function(e,n){init_block_vars(this,e,n)}),AST_Scope.DEFMETHOD("init_vars",function(e,n){init_scope_vars(this,e,n)}),AST_Arrow.DEFMETHOD("init_vars",function(e,n){return init_scope_vars(this,e,n),this}),AST_AsyncArrow.DEFMETHOD("init_vars",function(e,n){init_scope_vars(this,e,n)}),AST_Lambda.DEFMETHOD("init_vars",function(e,n){return init_scope_vars(this,e,n),this.uses_arguments=!1,this.def_variable(new AST_SymbolFunarg({name:"arguments",scope:this,start:this.start,end:this.end})),this}),AST_Symbol.DEFMETHOD("mark_enclosed",function(e){for(var n=this.definition(),a=this.scope;a&&push_uniq(a.enclosed,n)&&(e?(e.keep_fargs&&a instanceof AST_Lambda&&a.each_argname(function(e){push_uniq(n.scope.enclosed,e.definition())}),e.keep_fnames&&a.functions.each(function(e){push_uniq(n.scope.enclosed,e)})):a._var_names=void 0,a!==n.scope);a=a.parent_scope);}),AST_Symbol.DEFMETHOD("reference",function(e){this.definition().references.push(this),this.mark_enclosed(e)}),AST_BlockScope.DEFMETHOD("find_variable",function(e){return this.variables.get(e)||this.parent_scope&&this.parent_scope.find_variable(e)}),AST_BlockScope.DEFMETHOD("def_function",function(e,n){var a=this.def_variable(e,n);return(!a.init||a.init instanceof AST_LambdaDefinition)&&(a.init=n),this.functions.set(e.name,a),a}),AST_BlockScope.DEFMETHOD("def_variable",function(e,n){var a=this.variables.get(e.name);return a?(a.orig.push(e),a.init instanceof AST_LambdaExpression&&(a.init=n)):(a=this.make_def(e,n),this.variables.set(e.name,a),a.global=!this.parent_scope),e.thedef=a}),AST_Symbol.DEFMETHOD("unmangleable",function(e){var n=this.definition();return!n||n.unmangleable(e)}),AST_Label.DEFMETHOD("unmangleable",return_false),AST_Symbol.DEFMETHOD("definition",function(){return this.thedef}),AST_Toplevel.DEFMETHOD("mangle_names",function(o){(o=_default_mangler_options(o)).cache&&o.cache.props&&(n=names_in_use(this,o),o.cache.props.each(function(e){n.set(e,!0)}));var n,r=-1,s=[],c=new TreeWalker(function(a,e){var n,t,i;if(a instanceof AST_BlockScope)return a instanceof AST_LabeledStatement&&(n=r),o.webkit&&a instanceof AST_IterationStatement&&a.init instanceof AST_Let&&a.init.definitions.forEach(function(e){e.name.match_symbol(function(e){var n,a,t;e instanceof AST_SymbolLet&&(n=e.definition(),a=e.scope.parent_scope,t=a.def_variable(e),e.thedef=n,a.to_mangle.push(t),n.redefined=function(){return t})})},!0),t=a.to_mangle=[],a.variables.each(function(e,n){e.unmangleable(o)?names_in_use(a,o).set(n,!0):function(n){var e=n.orig[0],a=n.redefined();if(!a){if(!(e instanceof AST_SymbolConst))return;var t=n.scope.resolve();if(n.scope===t)return;if(n.scope.parent_scope.find_variable(e.name))return;a=t.def_variable(e),t.to_mangle.push(a)}s.push(n),n.references.forEach(i),(e instanceof AST_SymbolCatch||e instanceof AST_SymbolConst)&&(i(e),n.redefined=function(){return a});return 1;function i(e){e.thedef=a,e.reference(o),e.thedef=n}}(e)||t.push(e)}),e(),o.cache&&a instanceof AST_Toplevel&&a.globals.each(f),a instanceof AST_Defun&&c.has_directive("use asm")&&((e=new AST_SymbolRef(a.name)).scope=a,e.reference(o)),(t=36<t.length?(e=t.map(function(e,n){return n}).sort(function(e,n){return t[n].references.length-t[e].references.length||e-n})).slice(0,36).sort(function(e,n){return e-n}).map(function(e){return t[e]}).concat(e.slice(36).sort(function(e,n){return e-n}).map(function(e){return t[e]})):t).forEach(f),!(a instanceof AST_LabeledStatement)||o.v8&&function(e){var n,a=0;for(;n=e.parent(a++);){if(n instanceof AST_Block)return n instanceof AST_Toplevel&&!o.toplevel;if(n instanceof AST_LabeledStatement)return 1}}(c)||(r=n),!0;if(a instanceof AST_Label){for(;i=base54(++r),RESERVED_WORDS[i];);return a.mangled_name=i,!0}});function f(e){o.reserved.has[e.name]||e.mangle(o)}this.walk(c),s.forEach(f)}),AST_Toplevel.DEFMETHOD("find_colliding_names",function(a){var t=a.cache&&a.cache.props,n=Object.create(RESERVED_WORDS);return a.reserved.forEach(i),this.globals.each(o),this.walk(new TreeWalker(function(e){e instanceof AST_BlockScope&&e.variables.each(o)})),n;function i(e){n[e]=!0}function o(e){var n=e.name;if(e.global&&t&&t.has(n))n=t.get(n);else if(!e.unmangleable(a))return;i(n)}}),AST_Toplevel.DEFMETHOD("expand_names",function(t){base54.reset(),base54.sort(),t=_default_mangler_options(t);var i=this.find_colliding_names(t),o=0;function n(n){var e,a;n.global&&t.cache||n.unmangleable(t)||t.reserved.has[n.name]||(e=n.redefined(),a=e?e.rename||e.name:function(){for(var e;e=base54(o++),i[e];);return e}(),n.rename=a,n.forEach(function(e){e.definition()===n&&(e.name=a)}))}this.globals.each(n),this.walk(new TreeWalker(function(e){e instanceof AST_BlockScope&&e.variables.each(n)}))}),AST_Node.DEFMETHOD("tail_node",return_this),AST_Sequence.DEFMETHOD("tail_node",function(){return this.expressions[this.expressions.length-1]}),AST_Toplevel.DEFMETHOD("compute_char_frequency",function(e){e=_default_mangler_options(e),base54.reset();var n=AST_Symbol.prototype.add_source_map;try{AST_Symbol.prototype.add_source_map=function(){this.unmangleable(e)||base54.consider(this.name,-1)},e.properties&&(AST_Dot.prototype.add_source_map=function(){base54.consider(this.property,-1)},AST_Sub.prototype.add_source_map=function(){!function e(n){n instanceof AST_String?base54.consider(n.value,-1):n instanceof AST_Conditional?(e(n.consequent),e(n.alternative)):n instanceof AST_Sequence&&e(n.tail_node())}(this.property)}),base54.consider(this.print_to_string(),1)}finally{AST_Symbol.prototype.add_source_map=n,delete AST_Dot.prototype.add_source_map,delete AST_Sub.prototype.add_source_map}base54.sort()});var base54=function(){var i=Object.create(null);function e(e){for(var n=[],a=0;a<e.length;a++){var t=e[a];n.push(t),i[t]=-.01*a}return n}var a,t,n=e("0123456789"),o=e("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_");function r(){a=null,t=Object.create(i)}function s(e,n){return t[n]-t[e]}function c(e){var n=o[e%54];for(e=Math.floor(e/54);0<=--e;e>>=6)n+=a[63&e];return n}return c.consider=function(e,n){for(var a=e.length;0<=--a;)t[e[a]]+=n},c.sort=function(){a=o.sort(s).concat(n).sort(s)},(c.reset=r)(),c}();