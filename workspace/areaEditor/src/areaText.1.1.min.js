/**
 * AreaEditor 1.1
 * @github.com/kohunglee/areaEditor
 * @license MIT
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.AreaEditor=e()}(this,function(){"use strict";function n(t,e){if(!(this instanceof n))return new n(t,e);this.element="string"==typeof t?document.querySelectorAll(t):t,this.init()}return n.prototype.init=function(){for(var t=0;t<this.element.length;t++){if(!this.element[t])return void console.error("AreaEditor: Missing element");if("TEXTAREA"!==this.element[t].tagName)return void console.error("AreaEditor: The element must be a textarea");this.indentType=this._detectFirstIndent(this.element[t].value),this.tabChar="tab"===this.indentType.type?"\t":Array(this.indentType.count+1).join(" "),this.tabLength=this.indentType.count,this.setupEvents(this.element[t])}},n.prototype.setupEvents=function(t){t.addEventListener("keydown",this.onKeyDown.bind(this)),t.addEventListener("input",this.onInput.bind(this)),t.addEventListener("paste",this.onPaste.bind(this))},n.prototype.currentKey="",n.prototype.onPaste=function(t){this.currentKey="paste"},n.prototype.onInput=function(t){if("paste"===this.currentKey)return this.currentKey="",!1;var e=t.target.selectionStart,n=t.target.selectionEnd,r=t.target.value,i=r[e],s=r[e-1],a=r[e-2],o={"{":"}","[":"]","(":")",'"':'"',"'":"'","`":"`","<":">"};if(["{","(","[","<",'"',"'","`","]","}",")",">"].includes(s)&&e===n){var u,n=o[s]||"";for(u in o)if(u===a&&o[u]===s&&i===s)return t.target.value=r.substring(0,e)+r.substring(e+1),void(t.target.selectionStart=t.target.selectionEnd=e);"Backspace"!==this.currentKey&&(t.target.value=r.substring(0,e)+n+r.substring(e),t.target.selectionStart=t.target.selectionEnd=e)}},n.prototype.onKeyDown=function(t){var e=t.target.selectionStart,n=t.target.selectionEnd,r=t.target.value;if(this.currentKey=t.key,"Enter"===t.key)t.preventDefault(),h=r.lastIndexOf("\n",e-1)+1,l=(h=r.substring(h,e)).match(/^\s*/)[0],a={"{":"}","[":"]","(":")","<":">",">":"<"},h=h.trim().slice(-1),s=r.substring(e,e+1),a[h]?(g=s===a[h]?"\n"+l+this.tabChar+"\n"+l:"\n"+l+this.tabChar,t.target.value=r.substring(0,e)+g+r.substring(n),t.target.selectionStart=t.target.selectionEnd=e+l.length+1+this.tabLength):(g="\n"+l,t.target.value=r.substring(0,e)+g+r.substring(n),t.target.selectionStart=t.target.selectionEnd=e+g.length);else if("Tab"===t.key)if(t.preventDefault(),e===n)t.target.value=r.substring(0,e)+this.tabChar+r.substring(n),t.target.selectionStart=t.target.selectionEnd=e+this.tabLength;else{var i=r.split("\n"),s=r.split("\n"),a=(r.substring(0,e).match(/\n/g)||[]).length,o=(r.substring(0,n).match(/\n/g)||[]).length;if(t.shiftKey){for(var u=a;u<=o;u++)i[u]=this._removeLeadingSpaces(i[u],this.tabLength);t.target.value=i.join("\n");var h=s[a].length-s[a].trimStart().length,l=Math.min(this.tabLength,h),g=this._arrSum(i,a);t.target.selectionStart=0<h?e-l-a<g?g+a:e-l:e,t.target.selectionEnd=n-(s.join("\n").length-t.target.value.length)}else{for(u=a;u<=o;u++)i[u]=this.tabChar+i[u];t.target.value=i.join("\n"),t.target.selectionStart=e+this.tabLength,t.target.selectionEnd=n+this.tabLength*(a===o?1:o-a+1)}}},n.prototype._detectFirstIndent=function(t){for(var e=t.split("\n"),n=0;n<e.length;n++){var r,i=e[n];if(0<i.length&&/^\s/.test(i))return{type:r=-1!==(i=i.match(/^\s+/)[0]).indexOf("\t")?"tab":"space",count:"tab"==r?1:i.length}}return{type:"space",count:4}},n.prototype._removeLeadingSpaces=function(t,e){e=new RegExp("^([ \\t]{0,".concat(e,"})"));return t.replace(e,"")},n.prototype._arrSum=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return t.slice(0,e).map(function(t){return n+=t.length}),n},n});