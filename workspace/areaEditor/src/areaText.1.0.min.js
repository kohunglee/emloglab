/**
 * AreaEditor
 * @v1.0
 * @github.com/kohunglee/areaEditor
 * @license MIT
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.AreaEditor=e()}(this,function(){"use strict";function n(t,e){if(!(this instanceof n))return new n(t,e);this.element="string"==typeof t?document.querySelectorAll(t):t,this.init()}return n.prototype.init=function(){for(var t=0;t<this.element.length;t++){if(!this.element[t])return void console.error("AreaEditor: Missing element");if("TEXTAREA"!==this.element[t].tagName)return void console.error("AreaEditor: The element must be a textarea");this.indentType=this._detectFirstIndent(this.element[t].value),this.tabChar="tab"===this.indentType.type?"\t":Array(this.indentType.count+1).join(" "),this.tabLength=this.indentType.count,this.setupEvents(this.element[t])}},n.prototype.setupEvents=function(t){t.addEventListener("keydown",this.onKeyDown.bind(this))},n.prototype.onKeyDown=function(t){var e=t.target.selectionStart,n=t.target.selectionEnd,r=t.target.value;if("Enter"===t.key)t.preventDefault(),o=r.lastIndexOf("\n",e-1)+1,g=(o=r.substring(o,e)).match(/^\s*/)[0],a={"{":"}","[":"]","(":")","<":">"},o=o.trim().slice(-1),i=r.substring(e,e+1),a[o]?(u=i===a[o]?"\n"+g+this.tabChar+"\n"+g:"\n"+g+this.tabChar,t.target.value=r.substring(0,e)+u+r.substring(n),t.target.selectionStart=t.target.selectionEnd=e+g.length+1+this.tabLength):(u="\n"+g,t.target.value=r.substring(0,e)+u+r.substring(n),t.target.selectionStart=t.target.selectionEnd=e+u.length);else{if(["{","(","[","<",'"',"'","`","]","}",")",">"].includes(t.key)&&e===n){t.preventDefault();var i={"{":"}","[":"]","(":")",'"':'"',"'":"'","`":"`","<":">"}[t.key]||"";if(['"',"'","`","]","}",")",">"].includes(t.key)&&t.target.value.charAt(e)===t.key)return void(t.target.selectionStart=this.selectionEnd=e+1);t.target.value=r.substring(0,e)+t.key+i+r.substring(e),t.target.selectionStart=t.target.selectionEnd=e+1}if("Tab"===t.key)if(t.preventDefault(),e===n)t.target.value=r.substring(0,e)+this.tabChar+r.substring(n),t.target.selectionStart=t.target.selectionEnd=e+this.tabLength;else{var s=r.split("\n"),a=r.split("\n"),o=(r.substring(0,e).match(/\n/g)||[]).length,l=(r.substring(0,n).match(/\n/g)||[]).length;if(event.shiftKey){for(var h=o;h<=l;h++)s[h]=this._removeLeadingSpaces(s[h],this.tabLength);t.target.value=s.join("\n");var g=a[o].length-a[o].trimStart().length,u=Math.min(this.tabLength,g),i=this._arrSum(s,o);t.target.selectionStart=0<g?e-u-o<i?i+o:e-u:e,t.target.selectionEnd=n-(a.join("\n").length-t.target.value.length)}else{for(h=o;h<=l;h++)s[h]=this.tabChar+s[h];t.target.value=s.join("\n"),t.target.selectionStart=e+this.tabLength,t.target.selectionEnd=n+this.tabLength*(o===l?1:l-o+1)}}}},n.prototype._detectFirstIndent=function(t){for(var e=t.split("\n"),n=0;n<e.length;n++){var r,i=e[n];if(0<i.length&&/^\s/.test(i))return{type:r=-1!==(i=i.match(/^\s+/)[0]).indexOf("\t")?"tab":"space",count:"tab"==r?1:i.length}}return{type:"space",count:4}},n.prototype._removeLeadingSpaces=function(t,e){e=new RegExp("^([ \\t]{0,".concat(e,"})"));return t.replace(e,"")},n.prototype._arrSum=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return t.slice(0,e).map(function(t){return n+=t.length}),n},n});